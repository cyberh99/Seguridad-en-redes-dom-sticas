



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Análisis de las vulnerabilidades presentes en un entorno doméstico">
      
      
      
        <meta name="author" content="Héctor Romero <i72roloh@uco.es>">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Analizando las redes Wifi - Seguridad en redes domésticas</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#analisis-de-redes-wifi" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Seguridad en redes domésticas" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Seguridad en redes domésticas
            </span>
            <span class="md-header-nav__topic">
              Analizando las redes Wifi
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Seguridad en redes domésticas" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Seguridad en redes domésticas
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Inicio" class="md-nav__link">
      Inicio
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../introduccion/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../raspberry/" title="Preparando el arsenal" class="md-nav__link">
      Preparando el arsenal
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../informationGathering/" title="Recolección de información" class="md-nav__link">
      Recolección de información
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Analizando las redes Wifi
      </label>
    
    <a href="./" title="Analizando las redes Wifi" class="md-nav__link md-nav__link--active">
      Analizando las redes Wifi
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#terminologia" title="Terminología" class="md-nav__link">
    Terminología
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canales-dentro-de-las-redes-wifi" title="Canales dentro de las redes wifi" class="md-nav__link">
    Canales dentro de las redes wifi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tipos-de-cifrado-en-redes-wifi" title="Tipos de cifrado en redes wifi" class="md-nav__link">
    Tipos de cifrado en redes wifi
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#funcionamiento-del-protocolo-wpa2" title="Funcionamiento del protocolo WPA2" class="md-nav__link">
    Funcionamiento del protocolo WPA2
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#four-way-handsake" title="Four-Way Handsake" class="md-nav__link">
    Four-Way Handsake
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wifi-protected-setup-wps" title="Wifi Protected Setup (WPS)" class="md-nav__link">
    Wifi Protected Setup (WPS)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#como-funciona-el-protocolo" title="¿Como funciona el protocolo?" class="md-nav__link">
    ¿Como funciona el protocolo?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vulnerabilidades" title="Vulnerabilidades" class="md-nav__link">
    Vulnerabilidades
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../crackingWifi/" title="Cracking de  redes Wifi" class="md-nav__link">
      Cracking de  redes Wifi
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../networkAttack/" title="Atacando la red interna" class="md-nav__link">
      Atacando la red interna
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../javascript/" title="POC: Inyectando Javascript Malicioso" class="md-nav__link">
      POC: Inyectando Javascript Malicioso
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#terminologia" title="Terminología" class="md-nav__link">
    Terminología
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#canales-dentro-de-las-redes-wifi" title="Canales dentro de las redes wifi" class="md-nav__link">
    Canales dentro de las redes wifi
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tipos-de-cifrado-en-redes-wifi" title="Tipos de cifrado en redes wifi" class="md-nav__link">
    Tipos de cifrado en redes wifi
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#funcionamiento-del-protocolo-wpa2" title="Funcionamiento del protocolo WPA2" class="md-nav__link">
    Funcionamiento del protocolo WPA2
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#four-way-handsake" title="Four-Way Handsake" class="md-nav__link">
    Four-Way Handsake
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wifi-protected-setup-wps" title="Wifi Protected Setup (WPS)" class="md-nav__link">
    Wifi Protected Setup (WPS)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#como-funciona-el-protocolo" title="¿Como funciona el protocolo?" class="md-nav__link">
    ¿Como funciona el protocolo?
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vulnerabilidades" title="Vulnerabilidades" class="md-nav__link">
    Vulnerabilidades
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="analisis-de-redes-wifi">Análisis de redes wifi<a class="headerlink" href="#analisis-de-redes-wifi" title="Permanent link">&para;</a></h1>
<p>En esta etapa tendremos que interacturar con los diferentes componentes de la red que desamos atacar (tantos elementos software como hardware) de forma que encontramos algún protocolo inseguro que podamos explotar con posterioridad.</p>
<p>Dentro de la tecnología wifi encontramos diferentes elementos en los cuales podemos basarnos para detectar vulnerabilidades. Tenemos que tener en cuenta el tipo de cifrado que está utilizando la red, de forma que si usa WEP sería muy fácil de romper mientras que con WPA la complejidad aumenta.</p>
<h2 id="terminologia">Terminología<a class="headerlink" href="#terminologia" title="Permanent link">&para;</a></h2>
<p>Durante las siguientes fases estaremos haciendo referencia a algunas palabras clave relacionadas con las redes wifi, a modo de recopilación dejaré aquí las pricipales:</p>
<ul>
<li>SSID / ESSID : Nombre de la red wifi</li>
<li>BSSID : Dirección física (MAC) del router / AP</li>
<li>Channel: Canal en el que se encunetra la red wifi que esta emitiendo</li>
<li>PWR: Power Range, intensidad con la que nos llega la señal. Lo ideal sería tener una por inferior a -50 para realizar auditorias.</li>
<li>ENC y CIPHER: Hace referencia al cifrado de la red así como la encriptación</li>
</ul>
<h2 id="canales-dentro-de-las-redes-wifi">Canales dentro de las redes wifi<a class="headerlink" href="#canales-dentro-de-las-redes-wifi" title="Permanent link">&para;</a></h2>
<p>Las redes wifi utilizan ondas de radio que nos permiten comunicarnos a través de una red. Las señales wifi pueden usar un determinado número de canales (13), que les permiten existir diferentes redes sin que existan interferencias, de forma que un canal en el cual no esten confguradas muchas redes wifi tendrá menos interferencias.</p>
<p>Cuando estamos escaneando en busca de redes wifi, será necesario conocer el canal en el que esta emitiendo nuestro objetivo de forma que podamos capturar con posteridad información relevante.</p>
<h2 id="tipos-de-cifrado-en-redes-wifi">Tipos de cifrado en redes wifi<a class="headerlink" href="#tipos-de-cifrado-en-redes-wifi" title="Permanent link">&para;</a></h2>
<p>Los principales cifrados que nos encontramos en las redes wireless son:</p>
<ul>
<li>WEP (Wired Equivalent Privacy)</li>
<li>WPA (Wi-Fi Protected Access)</li>
<li>WPA-2 (Wi-Fi Protected Access II)</li>
</ul>
<p>Estos procotolos, aunque encargados de cifrar la contraseña evitando que cualquier persona las lea con facilidad, no impiden que puedan ser capturados. Por lo cual, si obtenemos un paquete con la contraseña (aunque este cifrada) si dicha contraseña no es muy compleja será de menos trabajo computacional encontrarla.</p>
<p>La complejidad de la contraseña wifi es importante, sin embargo, no tenemos que olvidar la importancia de aplicar el protocolo adecuado de cifrado. El cifrado WEP es el más antiguo, por lo tanto es más vulnerable al existir más ataques.Estos protocolos han ido evolucionando con el tiempo, de forma que se pudieran solventar las diferentes vulnerabilidades que se iban descubriendo, sin embargo, las vulnerabilidades en estos protocolos siguen apareciendo, una de las más recientes es <a href="https://papers.mathyvanhoef.com/ccs2017.pdf">Krack</a>.</p>
<p>Recientemente se esta comenzando con la implantación de un nuevo protocolo de cifrado WPA3, sin embargo, desde que este protocolo se comience ha implementar hasta que se convierta en el estándar pasará un considerable periodo de tiempo ( así como paso con la implementación de WPA )</p>
<h3 id="funcionamiento-del-protocolo-wpa2">Funcionamiento del protocolo WPA2<a class="headerlink" href="#funcionamiento-del-protocolo-wpa2" title="Permanent link">&para;</a></h3>
<p>En este escenario se va a simular uno de los casos más comunes, una red con cifrado WPA PSK (Pre Shared Key). Antes de continuar con la obtención de la contraseña, pasaremos a explicar como funciona el cifrado WPA2 y que es el 4-Way-Handsake.</p>
<p>El cifrado WPA se implementó aumentando la seguridad existente en su predecesor WPA, para ello se cambio el tipo de cifrado que se utilizaba, siendo AES (Advanced Encription Standard) el que implenta WPA2. WPA2 queda implementado con el estándar <a href="https://es.wikipedia.org/wiki/IEEE_802.11i-2004">IEEE 802.11 i</a>. Este estándar proveía RsN (Robust Security Network), para lo cual fue necesario la implementación de 2 protocolos:</p>
<ul>
<li>Four-Way Handsake, usado para para la autenticación</li>
<li>Group Key Hansake, usado para validar el tráfico multicast y de broadcast</li>
</ul>
<p>El estándar proveía de dos protocolos de integridad y confidencialidad de datos: CCMP y TKIP, siendo este último el más robusto puesto que CCMP se implementó para obtener compatibilidad con los routers que soportaban cifrado WEP.</p>
<p>WPA2 realiza una autenticacicón inicial mediante PSK (Pre Shared Key) o siguiendo un cambio EAP mediante el estándar 802.1x (implementación en Linux bajo <a href="https://w1.fi/wpa_supplicant/">wpa_supplicant</a>), sin embargo este último método requiere un servidor EAPOL de autenticación, por lo cual en entornos domésticos es menos usual encontrarlo. Esta contraseña compartida permite asegurar que el dispositivo que quiere conectarse esta autenticado en el punto de acceso.</p>
<p>Posterior a este intercambio de claves, se procede a la generación de una clave privada denominada PMK(Pairwise Master Key), la cual es el resultado de pasar la contraseña a la función criptográfica PBKDF2-SHA1. Cuando nos encontramos en una Pre-Shared-Key Network la PMK (Pairwise Master Key) y PSK (Pairwise Transient Key) coinciden.</p>
<h4 id="four-way-handsake">Four-Way Handsake<a class="headerlink" href="#four-way-handsake" title="Permanent link">&para;</a></h4>
<p>El protocolo Four-Way Handsake fue ideado con la intención de que el AP (Access Point) y el cliente puedan probar que conocen las claves PSK/PMK sin necesidad de revelar dicha clave. Para poder realizar esto el AP y el cliente encriptan los mensajes y se los envían al otro (dichos mensajes se pueden desencriptar con la PMK), si se logra desencriptarlos correctamente se demuestra que tienen conocimiento de la PSK.</p>
<p>Four-Way Handsake usa una PTK(Pairwise Transient Key), la cual esta compuesta por una combinanción de :</p>
<ul>
<li>PMK</li>
<li>AP nonce (ANonce) y STA nonce (SNonce)</li>
<li>AP Mac</li>
<li>STA Mac</li>
</ul>
<p>El producto de estos valores introducido en una función pseudoaleatoria tiene como resultado la PTK. El Handsake contiene también la GTK (Group Temporal Key), la cual es usada para desencriptar el tráfico de multicast y broadcast.</p>
<p><img alt="Four-Way Handsake" src="../img/4-way-handshake.png" /></p>
<ol>
<li>
<p>El AP envía un paquete Anonce (el cual contiene un valor que solo puede ser usado una vez en una función criptográfica) y un Key Replay Counter encargado de llevar la cuenta de los paquetes que se han transmitido.</p>
</li>
<li>
<p>El cliente (STA) responde con SNonce junto con un MIC (Message Integrity code), el cual incluye aunteticación, por lo tanto es un MAIC (Message Authentication Integrity Code) y el Key Replay Counter</p>
</li>
<li>
<p>El AP comprueba si el mensaje 2 es correcto mediante los campos MIC, Key Replay Counter, MIC, Anonce y RSN. Si el mensaje es correcto pasará a generar la GTK con otro MIC.</p>
</li>
<li>
<p>El STA verifica los datos del mensaje 3 y si es válido envía confirmación al AP.</p>
</li>
</ol>
<p>Este protocolo es vulnerable a KRACK, la cual fue parcheda adecuadamente. Sin embargo, se observaba que en 2018 existían dispositivos sin actualizar que podian ser vulnerables.</p>
<h3 id="wifi-protected-setup-wps">Wifi Protected Setup (WPS)<a class="headerlink" href="#wifi-protected-setup-wps" title="Permanent link">&para;</a></h3>
<p>Es un protocolo fue implementado en 2006 con la finalidad de que aquellos usuarios que carezcan de conocimintos sobre seguridad en redes wifi, tengan la opción de crear una conexión segura y agregar nuevos dispositivos a una red existente. Para poder realizar estas acciones se implementaron 4 modos:</p>
<ol>
<li>Método Pin: Este método consiste en introducir en el dispositivo un pin leido de una pegatina o pantalla en el dispositivo.</li>
<li>Presionando el botón: Este método consiste en presionar en ambos dispositivos (AP y STA) el botón de conexión, de forma que se active el modo de descubrimiento enlazando ambos dispositivos.</li>
<li>NFC </li>
<li>USB</li>
</ol>
<p>El método 3 y 4 se obvia la explicación puesto que han quedado completamente desactualizados.</p>
<h4 id="como-funciona-el-protocolo">¿Como funciona el protocolo?<a class="headerlink" href="#como-funciona-el-protocolo" title="Permanent link">&para;</a></h4>
<p>El protocolo consiste en un intercambio de mensajes EAP (Extensible Authentication Protocol), los cuales estan causados por una accion del usuario (confiando en una información previa). Esta información (WPS PIN) es intercambiada mediante un nuevo elemento de información (IE) que es agregado al beacon, probe response y opcionalmente al probe request y mensajes de petición/respuesta de asociación.</p>
<p>Tras esta comunicación entre los dispositivos el dispositivo comienza un protocolo de sesión. Esta sesión consiste en 8 mensajes que son seguidos (en caso de completarse satisfactoriamente) por un mensaje que indica que el procolo se ha completado correctamente.</p>
<h4 id="vulnerabilidades">Vulnerabilidades<a class="headerlink" href="#vulnerabilidades" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Online brute-force Attack: Este ataque consiste en realizar fuerza bruta al PIN del dispositivo, de forma que al obtenerlo se puede obtener la clave WPA. </p>
</li>
<li>
<p>Offline brute-force Attack: Esta ataque afecta a las implementaciones por defecto de algunos fabricantes. Consiste en obtener E-S1 y E-S2 nonces de forma que un fallo en la generación aleatoria de los mismos permite obtener el pin en un par de minutos. Este ataque es conocido como <em>pixiwps</em></p>
</li>
<li>
<p>Physical Security Issues: Cualquier fallo de seguridad puede ser extraído del router este no se encuentra en un lugar seguro.</p>
</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Es recomendable desactivar el WPS, debido a que supone uno de los principales factores de ataque frente a un punto de acceso.</p>
</div>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../informationGathering/" title="Recolección de información" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Recolección de información
              </span>
            </div>
          </a>
        
        
          <a href="../crackingWifi/" title="Cracking de  redes Wifi" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Cracking de  redes Wifi
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>